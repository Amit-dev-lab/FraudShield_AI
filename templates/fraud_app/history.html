{% extends 'base.html' %}

{% block title %}Transaction History{% endblock %}

{% block content %}
<style>
    body {
        background-color: #0d1117;
        color:  #8250df;
    }

    .page-title {
        color #8250df;
        font-weight: 600;
    }

    .page-subtitle {
        color: #b0b0b0;
        font-size: 1rem;
    }

    .card-custom {
        background-color: #161b22;
        border: 1px solid #30363d;
        border-radius: 12px;
        box-shadow: 0 0 10px rgba(0,0,0,0.5);
        color: #f0f0f0;
    }

    .table-custom {
        color: #f1f1f1;
        background-color: transparent;
    }

    .table-custom th {
        background-color: #1f2733;
        color: #c9d1d9;
        border-bottom: 1px solid #30363d;
        font-weight: 600;
    }

    .table-custom td {
        background-color: #161b22;
        border-top: 1px solid #2d333b;
    }

    .progress {
        background-color: #2c2f36;
    }

    .bg-success {
        background-color: #4caf50 !important;
    }

    .bg-warning {
        background-color: #ffc107 !important;
        color: #000 !important;
    }

    .bg-danger {
        background-color: #ef4444 !important;
    }

    .badge {
        font-size: 0.85rem;
    }

    .empty-state .icon {
        font-size: 3rem;
        color: #8b8b8b;
        margin-bottom: 1rem;
    }

    .btn-accent {
        background-color: rgb(156, 28, 241);
        color: white;
        border: none;
    }

    .btn-accent:hover {
        background-color: rgb(135, 20, 214);
    }

    a.btn {
        border-radius: 8px;
    }
</style>

<div class="container py-5">

    <!-- Page Header -->
    <div class="mb-4" data-aos="fade-down">
        <h1 class="page-title"><i class="fas fa-history me-2 text-purple"></i> Transaction History</h1>
        <p class="page-subtitle">A log of all your manual and API-driven fraud analysis requests.</p>
    </div>

    <div class="card card-custom" data-aos="fade-up">
        <div class="card-body p-0">
            {% if transactions %}
            <div class="table-responsive">
                <table class="table table-custom mb-0">
                    <thead>
                        <tr>
                            <th>Transaction ID</th>
                            <th>Date & Time</th>
                            <th>Amount</th>
                            <th>Category</th>
                            <th>Flow</th>
                            <th style="min-width: 150px;">Risk Score</th>
                            <th>Prediction</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for transaction in transactions %}
                        <tr>
                            <td class="fw-bold text-white">#{{ transaction.id }}</td>
                            <td>{{ transaction.created_at|date:"M d, Y, h:i A" }}</td>
                            <td class="fw-bold text-purple">₹{{ transaction.amount_inr|floatformat:2 }}</td>
                            <td>{{ transaction.category|title }}</td>
                            <td>{{ transaction.sender_city }} → {{ transaction.receiver_city }}</td>
                            <td>
                                <div class="progress" style="height: 22px;">
                                    <div class="progress-bar 
                                        {% if transaction.risk_score > 70 %}bg-danger
                                        {% elif transaction.risk_score > 40 %}bg-warning
                                        {% else %}bg-success{% endif %}" 
                                        role="progressbar"
                                        style="width: {{ transaction.risk_score }}%" 
                                        aria-valuenow="{{ transaction.risk_score }}" 
                                        aria-valuemin="0" 
                                        aria-valuemax="100">
                                        {{ transaction.risk_score|floatformat:1 }}%
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="badge rounded-pill
                                    {% if transaction.recommendation == 'decline' %}bg-danger
                                    {% elif transaction.recommendation == 'flag' %}bg-warning
                                    {% else %}bg-success{% endif %}">
                                    <i class="fas 
                                        {% if transaction.recommendation == 'decline' %}fa-times-circle
                                        {% elif transaction.recommendation == 'flag' %}fa-flag
                                        {% else %}fa-check-circle{% endif %} me-1"></i>
                                    {{ transaction.recommendation|title }}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center empty-state m-3">
                <div class="icon"><i class="fas fa-file-invoice-dollar"></i></div>
                <h5>No History Found</h5>
                <p>Your analysis history will appear here once you perform a check.</p>
                <a href="{% url 'manual_check' %}" class="btn btn-accent mt-3">
                    <i class="fas fa-plus me-2"></i>Perform First Check
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
